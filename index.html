<!DOCTYPE html>

<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://api.anthropic.com;">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="MarketMacros">
<meta name="application-name" content="MarketMacros">
<meta name="theme-color" content="#070d14">
<meta name="description" content="AI-powered futures & commodities intelligence terminal">
<title>MarketMacros â€” Futures & Commodities Intelligence</title>
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjogIk1hcmtldE1hY3JvcyIsICJzaG9ydF9uYW1lIjogIk1hcmtldE1hY3JvcyIsICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLCAic3RhcnRfdXJsIjogIi4vIiwgImJhY2tncm91bmRfY29sb3IiOiAiIzA3MGQxNCIsICJ0aGVtZV9jb2xvciI6ICIjMDcwZDE0IiwgImljb25zIjogW3sic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIWnBaWGRDYjNnOUlqQWdNQ0F4T1RJZ01Ua3lJajQ4WTJseVkyeGxJR040UFNJNU5pSWdZM2s5SWprMklpQnlQU0k1TmlJZ1ptbHNiRDBpSXpBM01HUXhOQ0l2UGp4amFYSmpiR1VnWTNnOUlqazJJaUJqZVQwaU9UWWlJSEk5SWprd0lpQm1hV3hzUFNKdWIyNWxJaUJ6ZEhKdmEyVTlJaU13TUdNNFpqQWlJSE4wY205clpTMTNhV1IwYUQwaU5DSXZQanh3YjJ4NVoyOXVJSEJ2YVc1MGN6MGlNVEUxTERJd0lEWTRMREV3TkNBNU9Dd3hNRFFnTnpZc01UY3lJREV6Tml3NE1pQXhNRFFzT0RJaUlHWnBiR3c5SWlNd01HTTRaakFpTHo0OEwzTjJaejQ9IiwgInNpemVzIjogIjE5MngxOTIiLCAidHlwZSI6ICJpbWFnZS9zdmcreG1sIn1dfQ==">
<link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxOTIgMTkyIj48Y2lyY2xlIGN4PSI5NiIgY3k9Ijk2IiByPSI5NiIgZmlsbD0iIzA3MGQxNCIvPjxjaXJjbGUgY3g9Ijk2IiBjeT0iOTYiIHI9IjkwIiBmaWxsPSJub25lIiBzdHJva2U9IiMwMGM4ZjAiIHN0cm9rZS13aWR0aD0iNCIvPjxwb2x5Z29uIHBvaW50cz0iMTE1LDIwIDY4LDEwNCA5OCwxMDQgNzYsMTcyIDEzNiw4MiAxMDQsODIiIGZpbGw9IiMwMGM4ZjAiLz48L3N2Zz4=">
<link rel="apple-touch-startup-image" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxOTIgMTkyIj48Y2lyY2xlIGN4PSI5NiIgY3k9Ijk2IiByPSI5NiIgZmlsbD0iIzA3MGQxNCIvPjxjaXJjbGUgY3g9Ijk2IiBjeT0iOTYiIHI9IjkwIiBmaWxsPSJub25lIiBzdHJva2U9IiMwMGM4ZjAiIHN0cm9rZS13aWR0aD0iNCIvPjxwb2x5Z29uIHBvaW50cz0iMTE1LDIwIDY4LDEwNCA5OCwxMDQgNzYsMTcyIDEzNiw4MiAxMDQsODIiIGZpbGw9IiMwMGM4ZjAiLz48L3N2Zz4=">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  /* â”€â”€ THEME TOKENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  :root {
    --mono: 'Space Mono', monospace;
    --sans: 'DM Sans', sans-serif;
    --display: 'Syne', sans-serif;
  }

/* DARK (default) */
[data-theme=â€œdarkâ€] {
â€“bg:          #070d14;
â€“surface:     #0d1825;
â€“surface2:    #111e2e;
â€“border:      #1e3048;
â€“accent:      #00c8f0;
â€“accent2:     #00e887;
â€“red:         #ff3d5a;
â€“yellow:      #f5c400;
â€“orange:      #ff8c00;
â€“text:        #c8d8e8;
â€“text-dim:    #6a8aaa;
â€“text-bright: #eef4fa;
â€“tag-bull-bg: rgba(0,232,135,0.15); â€“tag-bull-fg: #00e887; â€“tag-bull-bd: rgba(0,232,135,0.35);
â€“tag-bear-bg: rgba(255,61,90,0.15); â€“tag-bear-fg: #ff3d5a; â€“tag-bear-bd: rgba(255,61,90,0.35);
â€“tag-neu-bg:  rgba(245,196,0,0.12); â€“tag-neu-fg:  #f5c400; â€“tag-neu-bd:  rgba(245,196,0,0.30);
â€“tag-cau-bg:  rgba(255,140,0,0.15); â€“tag-cau-fg:  #ff8c00; â€“tag-cau-bd:  rgba(255,140,0,0.35);
â€“alert-bg:    rgba(245,196,0,0.07); â€“alert-bd:    rgba(245,196,0,0.22);
â€“card-top:    linear-gradient(90deg,var(â€“accent),transparent);
â€“scan-color:  rgba(0,200,240,0.013);
}

/* LIGHT */
[data-theme=â€œlightâ€] {
â€“bg:          #f0f4f8;
â€“surface:     #ffffff;
â€“surface2:    #e8eef5;
â€“border:      #c8d4e0;
â€“accent:      #0070c0;
â€“accent2:     #007a45;
â€“red:         #c0001a;
â€“yellow:      #8a6000;
â€“orange:      #b85000;
â€“text:        #1a2a3a;
â€“text-dim:    #5a7080;
â€“text-bright: #0a1520;
â€“tag-bull-bg: #d4f0e2; â€“tag-bull-fg: #005a30; â€“tag-bull-bd: #8ecfb0;
â€“tag-bear-bg: #fadddd; â€“tag-bear-fg: #900015; â€“tag-bear-bd: #e8a0a0;
â€“tag-neu-bg:  #fef4cc; â€“tag-neu-fg:  #6a4800; â€“tag-neu-bd:  #d4b040;
â€“tag-cau-bg:  #fde8cc; â€“tag-cau-fg:  #8a3a00; â€“tag-cau-bd:  #d49060;
â€“alert-bg:    #fef9e0; â€“alert-bd:    #d4b040;
â€“card-top:    linear-gradient(90deg,var(â€“accent),transparent);
â€“scan-color:  transparent;
}

- { margin: 0; padding: 0; box-sizing: border-box; }

body {
background: var(â€“bg);
color: var(â€“text);
font-family: var(â€“sans);
min-height: 100vh;
overflow-x: hidden;
transition: background 0.3s, color 0.3s;
}

/* Scanline overlay */
body::before {
content: â€˜â€™;
position: fixed;
inset: 0;
background: repeating-linear-gradient(0deg, transparent, transparent 2px, var(â€“scan-color) 2px, var(â€“scan-color) 4px);
pointer-events: none;
z-index: 9999;
}

/* Corner decorations */
.corner-deco {
position: fixed;
width: 60px; height: 60px;
pointer-events: none;
z-index: 100;
}
.corner-deco::before, .corner-deco::after {
content: â€˜â€™;
position: absolute;
background: var(â€“accent);
}
.corner-deco.tl { top: 16px; left: 16px; }
.corner-deco.tl::before { width: 2px; height: 24px; top: 0; left: 0; }
.corner-deco.tl::after  { width: 24px; height: 2px; top: 0; left: 0; }
.corner-deco.br { bottom: 16px; right: 16px; }
.corner-deco.br::before { width: 2px; height: 24px; bottom: 0; right: 0; }
.corner-deco.br::after  { width: 24px; height: 2px; bottom: 0; right: 0; }

.container {
max-width: 1300px;
margin: 0 auto;
padding: 24px 24px 60px;
}

/* HEADER */
header {
border-bottom: 1px solid var(â€“border);
padding-bottom: 20px;
margin-bottom: 28px;
display: flex;
justify-content: space-between;
align-items: flex-end;
flex-wrap: wrap;
gap: 12px;
}

.header-left h1 {
font-family: var(â€“display);
font-size: 28px;
font-weight: 800;
color: var(â€“text-bright);
letter-spacing: -0.5px;
line-height: 1;
}

.header-left h1 span {
color: var(â€“accent);
}

.header-left .subtitle {
font-family: var(â€“mono);
font-size: 10px;
color: var(â€“text-dim);
letter-spacing: 3px;
margin-top: 6px;
text-transform: uppercase;
}

.header-right {
display: flex;
flex-direction: column;
align-items: flex-end;
gap: 6px;
}

.live-badge {
display: flex;
align-items: center;
gap: 7px;
font-family: var(â€“mono);
font-size: 10px;
color: var(â€“accent2);
letter-spacing: 2px;
text-transform: uppercase;
}

.live-dot {
width: 7px; height: 7px;
border-radius: 50%;
background: var(â€“accent2);
animation: pulse 1.4s infinite;
}

@keyframes pulse {
0%, 100% { opacity: 1; transform: scale(1); }
50% { opacity: 0.4; transform: scale(0.7); }
}

#current-date {
font-family: var(â€“mono);
font-size: 12px;
color: var(â€“yellow);
}

/* CONTROLS */
.controls {
display: flex;
gap: 12px;
margin-bottom: 28px;
flex-wrap: wrap;
align-items: center;
}

.btn {
font-family: var(â€“mono);
font-size: 11px;
letter-spacing: 1.5px;
text-transform: uppercase;
padding: 10px 20px;
border: 1px solid var(â€“border);
background: var(â€“surface);
color: var(â€“text);
cursor: pointer;
transition: all 0.2s;
position: relative;
overflow: hidden;
}

.btn::before {
content: â€˜â€™;
position: absolute;
inset: 0;
background: var(â€“accent);
opacity: 0;
transition: opacity 0.2s;
}

.btn:hover { color: var(â€“bg); border-color: var(â€“accent); }
.btn:hover::before { opacity: 1; }
.btn span { position: relative; z-index: 1; }

.btn.primary { background: var(â€“accent); color: var(â€“bg); border-color: var(â€“accent); font-weight: 700; }
.btn.primary::before { background: white; }

.event-input {
flex: 1;
min-width: 260px;
background: var(â€“surface);
border: 1px solid var(â€“border);
color: var(â€“text-bright);
padding: 10px 16px;
font-family: var(â€“sans);
font-size: 13px;
outline: none;
transition: border-color 0.2s;
}

.event-input:focus { border-color: var(â€“accent); }
.event-input::placeholder { color: var(â€“text-dim); }

/* STATUS BAR */
#status-bar {
font-family: var(â€“mono);
font-size: 11px;
color: var(â€“text-dim);
padding: 8px 14px;
background: var(â€“surface);
border-left: 3px solid var(â€“accent);
margin-bottom: 24px;
min-height: 36px;
display: flex;
align-items: center;
gap: 10px;
transition: all 0.3s;
}

#status-bar.loading { border-color: var(â€“yellow); color: var(â€“yellow); }
#status-bar.done { border-color: var(â€“accent2); color: var(â€“accent2); }
#status-bar.error { border-color: var(â€“red); color: var(â€“red); }

.spinner {
width: 14px; height: 14px;
border: 2px solid currentColor;
border-top-color: transparent;
border-radius: 50%;
animation: spin 0.7s linear infinite;
flex-shrink: 0;
}

@keyframes spin { to { transform: rotate(360deg); } }

/* GRID LAYOUT */
.grid-2 {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 16px;
margin-bottom: 16px;
}

.grid-3 {
display: grid;
grid-template-columns: 1fr 1fr 1fr;
gap: 16px;
margin-bottom: 16px;
}

@media (max-width: 900px) {
.grid-2, .grid-3 { grid-template-columns: 1fr; }
}

/* CARDS */
.card {
background: var(â€“surface);
border: 1px solid var(â€“border);
padding: 20px;
position: relative;
overflow: hidden;
}

.card::after {
content: â€˜â€™;
position: absolute;
top: 0; left: 0; right: 0;
height: 2px;
background: linear-gradient(90deg, var(â€“accent), transparent);
}

.card.full-width {
grid-column: 1 / -1;
}

.card-label {
font-family: var(â€“mono);
font-size: 9px;
letter-spacing: 3px;
text-transform: uppercase;
color: var(â€“text-dim);
margin-bottom: 14px;
display: flex;
align-items: center;
gap: 8px;
}

.card-label::after {
content: â€˜â€™;
flex: 1;
height: 1px;
background: var(â€“border);
}

/* MARKET TICKER */
.ticker-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
gap: 10px;
margin-bottom: 20px;
}

.ticker-item {
background: var(â€“surface2);
border: 1px solid var(â€“border);
padding: 12px 14px;
position: relative;
cursor: default;
}

.ticker-name {
font-family: var(â€“mono);
font-size: 10px;
color: var(â€“text-dim);
letter-spacing: 1px;
margin-bottom: 4px;
}

.ticker-price {
font-family: var(â€“mono);
font-size: 18px;
font-weight: 700;
color: var(â€“text-bright);
line-height: 1;
}

.ticker-change {
font-family: var(â€“mono);
font-size: 10px;
margin-top: 4px;
}

.ticker-change.up { color: var(â€“accent2); }
.ticker-change.down { color: var(â€“red); }
.ticker-change.flat { color: var(â€“text-dim); }

.ticker-signal {
position: absolute;
top: 8px; right: 10px;
font-size: 14px;
}

/* CONTENT SECTIONS */
.section-block {
margin-bottom: 20px;
}

.section-title {
font-family: var(â€“display);
font-size: 13px;
font-weight: 700;
color: var(â€“accent);
letter-spacing: 1px;
text-transform: uppercase;
margin-bottom: 12px;
padding-bottom: 8px;
border-bottom: 1px solid var(â€“border);
}

/* TABLE */
.data-table {
width: 100%;
border-collapse: collapse;
font-size: 12px;
}

.data-table th {
font-family: var(â€“mono);
font-size: 9px;
letter-spacing: 2px;
text-transform: uppercase;
color: var(â€“text-dim);
padding: 8px 10px;
text-align: left;
border-bottom: 1px solid var(â€“border);
}

.data-table td {
padding: 10px 10px;
border-bottom: 1px solid rgba(26,45,66,0.5);
vertical-align: top;
line-height: 1.5;
}

.data-table tr:last-child td { border-bottom: none; }
.data-table tr:hover td { background: rgba(0,212,255,0.03); }

/* TAGS/BADGES */
.badge {
display: inline-block;
font-family: var(â€“mono);
font-size: 9px;
letter-spacing: 1px;
padding: 2px 7px;
border-radius: 2px;
font-weight: 700;
}

.badge.bull    { background: var(â€“tag-bull-bg); color: var(â€“tag-bull-fg); border: 1px solid var(â€“tag-bull-bd); }
.badge.bear    { background: var(â€“tag-bear-bg); color: var(â€“tag-bear-fg); border: 1px solid var(â€“tag-bear-bd); }
.badge.neutral { background: var(â€“tag-neu-bg);  color: var(â€“tag-neu-fg);  border: 1px solid var(â€“tag-neu-bd); }
.badge.caution { background: var(â€“tag-cau-bg);  color: var(â€“tag-cau-fg);  border: 1px solid var(â€“tag-cau-bd); }
.badge.high    { background: var(â€“tag-bear-bg); color: var(â€“tag-bear-fg); border: 1px solid var(â€“tag-bear-bd); }
.badge.med     { background: var(â€“tag-neu-bg);  color: var(â€“tag-neu-fg);  border: 1px solid var(â€“tag-neu-bd); }
.badge.low     { background: rgba(90,122,150,0.12); color: var(â€“text-dim); border: 1px solid rgba(90,122,150,0.2); }

/* GAME PLAN */
.game-plan-grid {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 10px;
}

.plan-item {
background: var(â€“surface2);
border: 1px solid var(â€“border);
padding: 12px 14px;
border-left: 3px solid var(â€“border);
}

.plan-item.bull-item { border-left-color: var(â€“accent2); }
.plan-item.bear-item { border-left-color: var(â€“red); }
.plan-item.warn-item { border-left-color: var(â€“yellow); }
.plan-item.info-item { border-left-color: var(â€“accent); }

.plan-label {
font-family: var(â€“mono);
font-size: 9px;
letter-spacing: 2px;
text-transform: uppercase;
color: var(â€“text-dim);
margin-bottom: 6px;
}

.plan-value {
font-size: 13px;
color: var(â€“text-bright);
line-height: 1.5;
font-weight: 500;
}

/* ALERT FLASH */
.market-alert {
background: var(â€“alert-bg);
border: 1px solid var(â€“alert-bd);
border-left: 4px solid var(â€“yellow);
padding: 14px 16px;
margin-bottom: 12px;
animation: alertPop 0.4s ease;
}

@keyframes alertPop {
from { opacity: 0; transform: translateY(-6px); }
to   { opacity: 1; transform: translateY(0); }
}

.alert-title {
font-family: var(â€“mono);
font-size: 10px;
letter-spacing: 2px;
color: var(â€“accent);
text-transform: uppercase;
margin-bottom: 6px;
}

.alert-body {
font-size: 13px;
color: var(â€“text-bright);
line-height: 1.6;
}

/* AI ANALYSIS */
.ai-block {
background: var(â€“surface2);
border: 1px solid var(â€“border);
padding: 18px;
font-size: 13px;
line-height: 1.8;
color: var(â€“text);
white-space: pre-wrap;
position: relative;
}

.ai-block::before {
content: â€˜AI ANALYSISâ€™;
display: block;
font-family: var(â€“mono);
font-size: 9px;
letter-spacing: 3px;
color: var(â€“accent);
margin-bottom: 12px;
padding-bottom: 8px;
border-bottom: 1px solid var(â€“border);
}

/* EMPTY STATE */
.empty {
text-align: center;
padding: 40px 20px;
color: var(â€“text-dim);
font-family: var(â€“mono);
font-size: 11px;
letter-spacing: 2px;
}

.empty .icon { font-size: 28px; margin-bottom: 10px; opacity: 0.4; }

/* FOOTER */
footer {
margin-top: 40px;
padding-top: 20px;
border-top: 1px solid var(â€“border);
display: flex;
justify-content: space-between;
align-items: center;
flex-wrap: wrap;
gap: 12px;
}

footer span {
font-family: var(â€“mono);
font-size: 10px;
color: var(â€“text-dim);
letter-spacing: 1px;
}

/* SCROLLBAR */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(â€“bg); }
::-webkit-scrollbar-thumb { background: var(â€“border); border-radius: 0; }
::-webkit-scrollbar-thumb:hover { background: var(â€“accent); }

.number-up { color: var(â€“accent2); }
.number-down { color: var(â€“red); }

.section-mb { margin-bottom: 28px; }

/* OPTIONS FLOW MODULE */
.gex-bar-wrap { display:flex; align-items:center; gap:10px; margin-bottom:6px; }
.gex-label { font-family:var(â€“mono); font-size:9px; color:var(â€“text-dim); letter-spacing:1px; width:100px; flex-shrink:0; text-align:right; }
.gex-bar-track { flex:1; height:10px; background:var(â€“surface2); border:1px solid var(â€“border); position:relative; overflow:hidden; }
.gex-bar-fill { position:absolute; top:0; height:100%; transition:width 0.6s ease; }
.gex-bar-fill.pos { background:linear-gradient(90deg,var(â€“accent2),rgba(0,255,157,0.3)); left:0; }
.gex-bar-fill.neg { background:linear-gradient(270deg,var(â€“red),rgba(255,69,96,0.3)); right:0; }
.gex-val { font-family:var(â€“mono); font-size:10px; width:80px; flex-shrink:0; }

.strike-level { display:flex; align-items:center; gap:8px; padding:7px 10px; border-bottom:1px solid rgba(26,45,66,0.5); font-size:11px; }
.strike-level:last-child { border-bottom:none; }
.strike-price { font-family:var(â€“mono); font-size:13px; font-weight:700; width:72px; flex-shrink:0; }
.strike-type { font-family:var(â€“mono); font-size:9px; letter-spacing:1px; padding:2px 6px; flex-shrink:0; }
.strike-type.call-wall  { background:rgba(255,69,96,0.15); color:var(â€“red); border:1px solid rgba(255,69,96,0.3); }
.strike-type.put-wall   { background:rgba(0,255,157,0.12); color:var(â€“accent2); border:1px solid rgba(0,255,157,0.25); }
.strike-type.gamma-flip { background:rgba(255,208,0,0.12); color:var(â€“yellow); border:1px solid rgba(255,208,0,0.3); }
.strike-type.max-pain   { background:rgba(0,212,255,0.12); color:var(â€“accent); border:1px solid rgba(0,212,255,0.25); }
.strike-type.pin-zone   { background:rgba(255,140,0,0.12); color:var(â€“orange); border:1px solid rgba(255,140,0,0.3); }

.dealer-mode { padding:12px 14px; margin-bottom:10px; border-left:4px solid var(â€“border); background:var(â€“surface2); }
.dealer-mode.long-gamma  { border-left-color:var(â€“accent2); }
.dealer-mode.short-gamma { border-left-color:var(â€“red); }
.dealer-mode.neutral     { border-left-color:var(â€“yellow); }
.dealer-mode-title { font-family:var(â€“mono); font-size:10px; letter-spacing:2px; text-transform:uppercase; margin-bottom:5px; }
.dealer-mode-body  { font-size:12px; color:var(â€“text); line-height:1.6; }

.flow-signal-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:12px; }
.flow-signal-item { background:var(â€“surface2); border:1px solid var(â€“border); padding:10px 12px; }
.flow-signal-label { font-family:var(â€“mono); font-size:9px; color:var(â€“text-dim); letter-spacing:2px; text-transform:uppercase; margin-bottom:5px; }
.flow-signal-val { font-size:13px; font-weight:600; color:var(â€“text-bright); line-height:1.4; }

.vol-chip { font-family:var(â€“mono); font-size:10px; padding:5px 10px; border:1px solid var(â€“border); background:var(â€“surface2); display:inline-block; margin:4px 4px 0 0; }
.vol-chip span { display:block; font-size:9px; color:var(â€“text-dim); margin-bottom:2px; letter-spacing:1px; }

.options-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
@media(max-width:800px){ .options-grid { grid-template-columns:1fr; } }
.options-sub-label { font-family:var(â€“mono); font-size:9px; letter-spacing:2px; color:var(â€“accent); text-transform:uppercase; margin-bottom:10px; padding-bottom:6px; border-bottom:1px solid var(â€“border); }

/* THEME SWITCHER */
.theme-bar {
display: flex; align-items: center; gap: 6px;
padding: 6px 10px;
background: var(â€“surface);
border: 1px solid var(â€“border);
border-radius: 2px;
}
.theme-bar-label {
font-family: var(â€“mono); font-size: 9px; letter-spacing: 2px;
color: var(â€“text-dim); text-transform: uppercase; margin-right: 4px;
}
.theme-btn {
width: 28px; height: 28px; border: 2px solid var(â€“border);
cursor: pointer; border-radius: 2px; position: relative;
transition: border-color 0.2s, transform 0.15s;
flex-shrink: 0;
}
.theme-btn:hover { transform: scale(1.12); border-color: var(â€“accent); }
.theme-btn.active { border-color: var(â€“accent); box-shadow: 0 0 0 2px rgba(0,200,240,0.25); }
.theme-btn[data-t=â€œdarkâ€]     { background: linear-gradient(135deg,#070d14 50%,#00c8f0 50%); }
.theme-btn[data-t=â€œlightâ€]    { background: linear-gradient(135deg,#f0f4f8 50%,#0070c0 50%); }
.theme-tooltip {
position: absolute; bottom: 34px; left: 50%; transform: translateX(-50%);
background: var(â€“surface2); border: 1px solid var(â€“border);
color: var(â€“text-bright); font-family: var(â€“mono); font-size: 8px;
letter-spacing: 1px; padding: 3px 6px; white-space: nowrap;
opacity: 0; pointer-events: none; transition: opacity 0.15s;
}
.theme-btn:hover .theme-tooltip { opacity: 1; }

/* â”€â”€ MOBILE / PWA OPTIMISATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@supports (padding-top: env(safe-area-inset-top)) {
.container {
padding-top: max(24px, env(safe-area-inset-top));
padding-bottom: max(60px, env(safe-area-inset-bottom));
padding-left: max(16px, env(safe-area-inset-left));
padding-right: max(16px, env(safe-area-inset-right));
}
}

@media (max-width: 600px) {
.container { padding: 16px 12px 80px; }
header { flex-direction: column; align-items: flex-start; gap: 10px; }
.header-left h1 { font-size: 22px; }
.theme-bar { flex-wrap: wrap; }
.controls { gap: 8px; }
.controls > div { flex-direction: column !important; }
.event-input { font-size: 16px !important; } /* prevent iOS zoom */
.grid-2, .grid-3 { grid-template-columns: 1fr; }
.game-plan-grid { grid-template-columns: 1fr; }
.options-grid { grid-template-columns: 1fr; }
.flow-signal-grid { grid-template-columns: 1fr; }
.ticker-grid { grid-template-columns: 1fr 1fr; }
.data-table { font-size: 11px; }
.data-table th { font-size: 8px; padding: 6px 6px; }
.data-table td { padding: 8px 6px; }
}

/* Bottom nav bar for mobile */
.mobile-nav {
display: none;
position: fixed;
bottom: 0; left: 0; right: 0;
background: var(â€“surface);
border-top: 1px solid var(â€“border);
padding: 8px 0;
padding-bottom: max(8px, env(safe-area-inset-bottom));
z-index: 1000;
justify-content: space-around;
align-items: center;
}
@media (max-width: 600px) { .mobile-nav { display: flex; } }

.nav-item {
display: flex; flex-direction: column; align-items: center; gap: 2px;
cursor: pointer; padding: 4px 12px; border-radius: 4px;
transition: background 0.15s;
background: none; border: none; color: var(â€“text-dim);
}
.nav-item.active { color: var(â€“accent); }
.nav-item:active { background: var(â€“surface2); }
.nav-icon { font-size: 18px; line-height: 1; }
.nav-label { font-family: var(â€“mono); font-size: 8px; letter-spacing: 1px; text-transform: uppercase; }

/* Section scroll targets */
.scroll-section { scroll-margin-top: 12px; }

/* Pull-to-refresh indicator */
.ptr-indicator {
text-align: center;
padding: 10px;
font-family: var(â€“mono);
font-size: 10px;
color: var(â€“accent);
letter-spacing: 2px;
display: none;
}

/* Loading skeleton pulse */
@keyframes skeleton {
0%, 100% { opacity: 0.4; }
50% { opacity: 0.8; }
}
.skeleton {
background: var(â€“border);
border-radius: 2px;
animation: skeleton 1.5s ease infinite;
}

/* Install banner */
#install-banner {
display: none;
position: fixed;
bottom: env(safe-area-inset-bottom, 0);
left: 0; right: 0;
background: var(â€“accent);
color: var(â€“bg);
padding: 14px 20px;
z-index: 2000;
align-items: center;
justify-content: space-between;
gap: 12px;
font-family: var(â€“sans);
}
#install-banner.show { display: flex; }
.install-text { font-size: 13px; font-weight: 600; flex: 1; }
.install-sub  { font-size: 11px; opacity: 0.8; }
.install-btn  {
background: var(â€“bg); color: var(â€“accent);
border: none; padding: 8px 16px; cursor: pointer;
font-family: var(â€“mono); font-size: 11px; letter-spacing: 1px;
font-weight: 700; white-space: nowrap;
flex-shrink: 0;
}
.install-close {
background: none; border: none; color: var(â€“bg);
font-size: 20px; cursor: pointer; padding: 0 4px; flex-shrink: 0;
}
</style>

</head>
<body>
<script>
  // Force theme immediately before any rendering
  (function(){
    let t = 'dark';
    try { t = localStorage.getItem('marketmacros-theme') || 'dark'; } catch(e) {}
    if (t === 'auto') t = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    document.documentElement.setAttribute('data-theme', t);
  })();
</script>

<div class="corner-deco tl"></div>
<div class="corner-deco br"></div>

<div class="container">

  <!-- HEADER -->

  <header>
    <div class="header-left">
      <h1>MARKET<span>MACROS</span></h1>
      <div class="subtitle">Futures &amp; Commodities Intelligence Terminal</div>
    </div>
    <div class="header-right">
      <div class="live-badge"><div class="live-dot"></div> LIVE AI POWERED</div>
      <div id="current-date">Loading...</div>
      <div class="theme-bar">
        <span class="theme-bar-label">Theme</span>
        <button class="theme-btn active" data-t="dark"  onclick="setTheme('dark')"  title="Dark"><div class="theme-tooltip">DARK</div></button>
        <button class="theme-btn"        data-t="light" onclick="setTheme('light')" title="Light"><div class="theme-tooltip">LIGHT</div></button>
      </div>
    </div>
  </header>

  <!-- CONTROLS -->

  <div class="controls" style="flex-direction:column;gap:10px">
    <!-- API KEY ROW -->
    <div style="display:flex;gap:10px;align-items:center;width:100%;flex-wrap:wrap;margin-bottom:4px">
      <div style="display:flex;flex-direction:column;gap:3px;flex:1;min-width:200px">
        <label style="font-family:var(--mono);font-size:9px;color:var(--red);letter-spacing:2px">ğŸ”‘ ANTHROPIC API KEY (required)</label>
        <input class="event-input" id="api-key-input" type="password"
          placeholder="sk-ant-api03-..."
          style="font-size:13px;letter-spacing:1px"
          oninput="saveApiKey(this.value)" />
      </div>
      <div style="font-family:var(--mono);font-size:9px;color:var(--text-dim);line-height:1.6;padding-bottom:2px">
        Get yours at<br><span style="color:var(--accent)">console.anthropic.com</span>
      </div>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;width:100%">
      <button class="btn primary" onclick="generateFullBrief()"><span>âš¡ Generate Full Brief</span></button>
      <button class="btn" onclick="testApiConnection()" style="border-color:var(--yellow);color:var(--yellow)"><span>ğŸ”§ Test API</span></button>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;flex:1">
        <div style="display:flex;flex-direction:column;gap:3px">
          <label style="font-family:var(--mono);font-size:9px;color:var(--accent);letter-spacing:2px">ES PRICE</label>
          <input class="event-input" id="es-price" type="number" placeholder="e.g. 6085" style="width:120px;padding:8px 10px" />
        </div>
        <div style="display:flex;flex-direction:column;gap:3px">
          <label style="font-family:var(--mono);font-size:9px;color:var(--accent);letter-spacing:2px">NQ PRICE</label>
          <input class="event-input" id="nq-price" type="number" placeholder="e.g. 21450" style="width:130px;padding:8px 10px" />
        </div>
        <div style="display:flex;flex-direction:column;gap:3px">
          <label style="font-family:var(--mono);font-size:9px;color:var(--accent);letter-spacing:2px">CL PRICE</label>
          <input class="event-input" id="cl-price" type="number" placeholder="e.g. 70.50" style="width:110px;padding:8px 10px" />
        </div>
        <div style="display:flex;flex-direction:column;gap:3px">
          <label style="font-family:var(--mono);font-size:9px;color:var(--accent);letter-spacing:2px">GC PRICE</label>
          <input class="event-input" id="gc-price" type="number" placeholder="e.g. 2940" style="width:110px;padding:8px 10px" />
        </div>
        <div style="font-family:var(--mono);font-size:9px;color:var(--text-dim);letter-spacing:1px;align-self:flex-end;padding-bottom:8px;line-height:1.5">
          Enter current prices<br>for accurate levels â†‘
        </div>
      </div>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;width:100%">
      <input class="event-input" id="event-input" type="text" style="flex:1"
        placeholder="Describe a market event (e.g. 'Jobless claims 280K vs 215K expected â€” what does this mean?')" />
      <button class="btn" onclick="analyzeEvent()"><span>ğŸ”” Analyze Event</span></button>
    </div>
  </div>

  <!-- STATUS BAR -->

  <div id="status-bar">
    <span>â—ˆ READY â€” Enter current prices then tap âš¡ Generate for LIVE data pulled fresh from the web right now "Generate Full Brief" for a fully anchored AI analysis. All strike levels will be calculated from your live prices.</span>
  </div>

  <!-- MARKET ALERTS ZONE -->

  <div id="alerts-zone"></div>

<!-- HOSTING WARNING -->

<div id="hosting-warning" style="display:none;background:rgba(255,61,90,0.08);border:1px solid rgba(255,61,90,0.3);border-left:4px solid var(--red);padding:18px 20px;margin-bottom:20px">
  <div style="font-family:var(--mono);font-size:10px;letter-spacing:2px;color:var(--red);margin-bottom:10px">âš  WRONG HOSTING â€” API CALLS BLOCKED</div>
  <div style="font-size:13px;color:var(--text-bright);margin-bottom:14px;line-height:1.6">
    <strong>htmlpreview.github.io</strong> blocks outbound API requests. You need to deploy this file to a proper host. The easiest option takes under 2 minutes:
  </div>
  <div style="background:var(--surface2);padding:14px;border:1px solid var(--border);margin-bottom:10px">
    <div style="font-family:var(--mono);font-size:10px;color:var(--accent);letter-spacing:2px;margin-bottom:8px">OPTION 1 â€” NETLIFY DROP (FASTEST â€” 60 seconds)</div>
    <div style="font-size:12px;color:var(--text);line-height:1.8">
      1. Go to <span style="color:var(--accent)">netlify.com/drop</span> on your phone<br>
      2. Download the <strong>PMB_Terminal.html</strong> file to your Files app<br>
      3. Rename it to <strong>index.html</strong><br>
      4. Drag it onto the Netlify Drop page<br>
      5. You get a live URL instantly â€” add that to your home screen
    </div>
  </div>
  <div style="background:var(--surface2);padding:14px;border:1px solid var(--border)">
    <div style="font-family:var(--mono);font-size:10px;color:var(--accent);letter-spacing:2px;margin-bottom:8px">OPTION 2 â€” GITHUB PAGES</div>
    <div style="font-size:12px;color:var(--text);line-height:1.8">
      1. Go to your GitHub repo â†’ Settings â†’ Pages<br>
      2. Set Source to <strong>main branch / root</strong><br>
      3. Your file must be named <strong>index.html</strong> in the repo root<br>
      4. GitHub gives you a <span style="color:var(--accent)">username.github.io/repo</span> URL<br>
      5. That URL works perfectly â€” add to iPhone home screen
    </div>
  </div>
</div>

  <!-- MACRO SNAPSHOT -->

  <div id="sec-macro" class="scroll-section">
  <div class="card section-mb" id="macro-card">
    <div class="card-label">ğŸŒ Macro Snapshot</div>
    <div id="macro-content">
      <div class="empty"><div class="icon">ğŸ“¡</div>AWAITING DATA FEED</div>
    </div>
  </div>

  </div>
  <!-- WATCHLIST + CALENDAR -->
  <div id="sec-watchlist" class="scroll-section">
  <div class="grid-2 section-mb">
    <div class="card">
      <div class="card-label">ğŸ¯ Futures Watchlist &amp; Key Levels</div>
      <div id="watchlist-content">
        <div class="empty"><div class="icon">ğŸ“Š</div>AWAITING DATA FEED</div>
      </div>
    </div>
    <div class="card">
      <div class="card-label">ğŸ“… Economic Calendar &amp; Events</div>
      <div id="calendar-content">
        <div class="empty"><div class="icon">ğŸ—“</div>AWAITING DATA FEED</div>
      </div>
    </div>
  </div>

  </div>
  <!-- COT + NEWS -->
  <div id="sec-cot" class="scroll-section">
  <div class="grid-2 section-mb">
    <div class="card">
      <div class="card-label">ğŸ“Š COT Report â€” Commitment of Traders</div>
      <div id="cot-content">
        <div class="empty"><div class="icon">ğŸ“ˆ</div>AWAITING DATA FEED</div>
      </div>
    </div>
    <div class="card">
      <div class="card-label">ğŸ“° Key News &amp; Sentiment</div>
      <div id="news-content">
        <div class="empty"><div class="icon">ğŸ—</div>AWAITING DATA FEED</div>
      </div>
    </div>
  </div>

  <!-- GAME PLAN -->

  <div class="card section-mb">
    <div class="card-label">ğŸ§  Today's Game Plan &amp; Market Bias</div>
    <div id="gameplan-content">
      <div class="empty"><div class="icon">ğŸ¯</div>AWAITING DATA FEED</div>
    </div>
  </div>

  </div>
  <!-- OPTIONS FLOW MODULE -->
  <div id="sec-options" class="scroll-section">
  <div class="card section-mb">
    <div class="card-label">âš¡ Options Flow &amp; Dealer Positioning Intelligence</div>
    <div id="options-flow-content">
      <div class="empty"><div class="icon">ğŸ°</div>AWAITING OPTIONS FLOW DATA</div>
    </div>
  </div>

  </div>
  <!-- AI MARKET OVERVIEW -->
  <div id="sec-ai" class="scroll-section">
  <div class="card section-mb">
    <div class="card-label">ğŸ¤– AI Market Intelligence Overview</div>
    <div id="ai-overview-content">
      <div class="empty"><div class="icon">ğŸ¤–</div>AWAITING AI ANALYSIS</div>
    </div>
  </div>

<!-- MOBILE BOTTOM NAV -->

<nav class="mobile-nav">
  <button class="nav-item active" onclick="mobileNav('sec-macro', this)">
    <span class="nav-icon">ğŸŒ</span><span class="nav-label">Macro</span>
  </button>
  <button class="nav-item" onclick="mobileNav('sec-watchlist', this)">
    <span class="nav-icon">ğŸ¯</span><span class="nav-label">Watch</span>
  </button>
  <button class="nav-item" onclick="mobileNav('sec-cot', this)">
    <span class="nav-icon">ğŸ“Š</span><span class="nav-label">COT</span>
  </button>
  <button class="nav-item" onclick="mobileNav('sec-options', this)">
    <span class="nav-icon">âš¡</span><span class="nav-label">Options</span>
  </button>
  <button class="nav-item" onclick="mobileNav('sec-ai', this)">
    <span class="nav-icon">ğŸ¤–</span><span class="nav-label">AI</span>
  </button>
</nav>

  <footer>
    <span>âš¡ MarketMacros â€” Futures &amp; Commodities Terminal</span>
    <span>Powered by Claude AI Â· Not financial advice Â· Always verify with live data</span>
    <span id="last-updated">Last updated: â€”</span>
  </footer>
</div>

<script>

// â”€â”€ THEME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getSystemTheme() {
  return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
}
function setTheme(t) {
  const r = t === 'auto' ? getSystemTheme() : t;
  document.documentElement.setAttribute('data-theme', r);
  document.querySelectorAll('.theme-btn').forEach(b => b.classList.toggle('active', b.dataset.t === t));
  try { localStorage.setItem('marketmacros-theme', t); } catch(e) {}
}
function initTheme() {
  let s = 'dark';
  try { s = localStorage.getItem('marketmacros-theme') || 'dark'; } catch(e) {}
  setTheme(s);
}
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
  try { if (localStorage.getItem('marketmacros-theme') === 'auto') setTheme('auto'); } catch(e) {}
});
initTheme();

// â”€â”€ API KEY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveApiKey(v) { try { localStorage.setItem('marketmacros-apikey', v.trim()); } catch(e) {} }
function getApiKey() {
  const f = document.getElementById('api-key-input');
  if (f && f.value.trim()) return f.value.trim();
  try { return localStorage.getItem('marketmacros-apikey') || ''; } catch(e) { return ''; }
}
(function loadKey() {
  try {
    const s = localStorage.getItem('marketmacros-apikey');
    if (s) { const f = document.getElementById('api-key-input'); if (f) f.value = s; }
  } catch(e) {}
})();

// â”€â”€ STATUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setStatus(msg, type) {
  const b = document.getElementById('status-bar');
  b.className = type ? 'loading ' + type : '';
  b.innerHTML = type === 'loading'
    ? '<div class="spinner"></div><span>' + msg + '</span>'
    : '<span>' + msg + '</span>';
  if (type === 'done') b.className = 'done';
  if (type === 'error') b.className = 'error';
}
function getDate() {
  return new Date().toLocaleDateString('en-US', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
}
function getTime() {
  return new Date().toLocaleTimeString('en-US', { hour:'2-digit', minute:'2-digit' });
}
document.getElementById('current-date').textContent = getDate();

// â”€â”€ STARTUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function() {
  try {
    if (window.location.hostname === 'htmlpreview.github.io') {
      setTimeout(() => setStatus('âš  Use GitHub Pages not htmlpreview â€” see repo Settings > Pages', 'error'), 500);
      return;
    }
    const last = localStorage.getItem('marketmacros-lastgen');
    const h = new Date().getHours();
    if ((!last || last !== new Date().toDateString()) && h >= 4 && h <= 14) {
      setTimeout(() => setStatus('â—ˆ NEW SESSION â€” Enter prices then tap âš¡ Generate Full Brief', ''), 1500);
    }
  } catch(e) {}
})();

// â”€â”€ CORE API CALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function claudeCall(prompt, maxTokens, isJSON) {
  const apiKey = getApiKey();
  if (!apiKey) throw new Error('No API key');
  const systemMsg = isJSON
    ? 'You are a futures markets analyst. Respond with ONLY a valid JSON object. No markdown, no backticks, no explanation. Start with { and end with }.'
    : 'You are a senior futures trading desk analyst. Be direct and specific.';
  const resp = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'x-api-key': apiKey,
      'anthropic-version': '2023-06-01',
      'anthropic-dangerous-direct-browser-access': 'true'
    },
    body: JSON.stringify({
      model: 'claude-sonnet-4-5',
      max_tokens: maxTokens || 1200,
      system: systemMsg,
      messages: [{ role: 'user', content: prompt }]
    })
  });
  if (!resp.ok) {
    const e = await resp.text();
    throw new Error('API ' + resp.status + ': ' + e.slice(0, 200));
  }
  const data = await resp.json();
  return data.content.filter(b => b.type === 'text').map(b => b.text).join('').trim();
}

// â”€â”€ JSON PARSER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function parseJ(text) {
  let t = text.replace(/```json/gi, '').replace(/```/g, '').trim();
  const os = t.indexOf('{'), oe = t.lastIndexOf('}');
  const as = t.indexOf('['), ae = t.lastIndexOf(']');
  let s, e;
  if (os === -1 && as === -1) throw new Error('No JSON in: ' + t.slice(0, 80));
  if (os === -1 || (as !== -1 && as < os)) { s = as; e = ae; }
  else { s = os; e = oe; }
  t = t.slice(s, e + 1).replace(/,(\s*[}\]])/g, '$1');
  return JSON.parse(t);
}

// â”€â”€ BADGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function badge(text) {
  const t = (text || '').toLowerCase();
  if (t.includes('bull')) return '<span class="badge bull">BULLISH</span>';
  if (t.includes('bear')) return '<span class="badge bear">BEARISH</span>';
  if (t.includes('caut')) return '<span class="badge caution">CAUTION</span>';
  if (t.includes('high')) return '<span class="badge high">HIGH</span>';
  if (t.includes('med'))  return '<span class="badge med">MEDIUM</span>';
  if (t.includes('low'))  return '<span class="badge low">LOW</span>';
  if (t.includes('elev')) return '<span class="badge caution">ELEVATED</span>';
  return '<span class="badge neutral">' + (text || 'NEUTRAL') + '</span>';
}

// â”€â”€ RENDERERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderMacro(data) {
  if (!data || !data.length) { document.getElementById('macro-content').innerHTML = '<div class="empty">No data</div>'; return; }
  let h = '<div class="ticker-grid">';
  data.forEach(item => {
    const dir = item.change && item.change.startsWith('-') ? 'down' : item.change ? 'up' : 'flat';
    const sig = (item.signal || '').toLowerCase();
    const dot = sig.includes('bull') ? 'ğŸŸ¢' : sig.includes('bear') ? 'ğŸ”´' : sig.includes('elev') ? 'ğŸŸ ' : 'ğŸŸ¡';
    h += '<div class="ticker-item"><div class="ticker-signal">' + dot + '</div><div class="ticker-name">' + item.name + '</div><div class="ticker-price">' + (item.price || 'â€”') + '</div><div class="ticker-change ' + dir + '">' + (item.change || '') + ' ' + (item.changePct || '') + '</div></div>';
  });
  h += '</div>';
  document.getElementById('macro-content').innerHTML = h;
}

function renderWatchlist(data) {
  if (!data || !data.length) { document.getElementById('watchlist-content').innerHTML = '<div class="empty">No data</div>'; return; }
  let h = '<table class="data-table"><thead><tr><th>Contract</th><th>Bias</th><th>Support</th><th>Resist</th><th>Setup</th></tr></thead><tbody>';
  data.forEach(item => {
    h += '<tr><td style="color:var(--text-bright);font-weight:600">' + item.contract + '</td><td>' + badge(item.bias) + '</td><td style="color:var(--accent2);font-family:var(--mono);font-size:11px">' + (item.support || 'â€”') + '</td><td style="color:var(--red);font-family:var(--mono);font-size:11px">' + (item.resistance || 'â€”') + '</td><td style="font-size:11px;color:var(--text-dim)">' + (item.setup || 'â€”') + '</td></tr>';
  });
  h += '</tbody></table><div style="margin-top:14px">';
  data.forEach(item => {
    if (item.idea) h += '<div style="font-size:11px;padding:6px 0;border-bottom:1px solid var(--border);color:var(--text)"><span style="color:var(--accent);font-family:var(--mono);font-size:9px">' + item.contract + '</span> â€” ' + item.idea + '</div>';
  });
  h += '</div>';
  document.getElementById('watchlist-content').innerHTML = h;
}

function renderCalendar(data) {
  if (!data || !data.length) { document.getElementById('calendar-content').innerHTML = '<div class="empty">No data</div>'; return; }
  let h = '<table class="data-table"><thead><tr><th>Time (ET)</th><th>Event</th><th>Forecast</th><th>Impact</th></tr></thead><tbody>';
  data.forEach(item => {
    h += '<tr><td style="font-family:var(--mono);font-size:10px;color:var(--yellow);white-space:nowrap">' + (item.time || 'â€”') + '</td><td style="color:var(--text-bright)">' + (item.event || 'â€”') + '</td><td style="font-family:var(--mono);font-size:10px">' + (item.forecast || 'â€”') + '</td><td>' + badge(item.impact) + '</td></tr>';
  });
  h += '</tbody></table>';
  document.getElementById('calendar-content').innerHTML = h;
}

function renderCOT(data) {
  if (!data || !data.length) { document.getElementById('cot-content').innerHTML = '<div class="empty">No data</div>'; return; }
  let h = '<table class="data-table"><thead><tr><th>Contract</th><th>Net Spec</th><th>WoW</th><th>Signal</th></tr></thead><tbody>';
  data.forEach(item => {
    const wdir = (item.wowChange || '').startsWith('+') ? 'number-up' : (item.wowChange || '').startsWith('-') ? 'number-down' : '';
    h += '<tr><td style="color:var(--text-bright);font-weight:600">' + item.contract + '</td><td style="font-family:var(--mono);font-size:11px">' + (item.netSpec || 'â€”') + '</td><td class="' + wdir + '" style="font-family:var(--mono);font-size:11px">' + (item.wowChange || 'â€”') + '</td><td>' + badge(item.signal) + '</td></tr><tr><td colspan="4" style="font-size:11px;color:var(--text-dim);padding:4px 10px 10px;border-bottom:1px solid var(--border)">' + (item.interpretation || '') + '</td></tr>';
  });
  h += '</tbody></table>';
  document.getElementById('cot-content').innerHTML = h;
}

function renderNews(data) {
  if (!data || !data.length) { document.getElementById('news-content').innerHTML = '<div class="empty">No data</div>'; return; }
  let h = '';
  data.forEach(item => {
    const b = (item.bias || '').toLowerCase();
    const col = b.includes('bull') ? 'var(--accent2)' : b.includes('bear') ? 'var(--red)' : 'var(--yellow)';
    h += '<div style="padding:12px 0;border-bottom:1px solid var(--border)"><div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px;margin-bottom:5px"><span style="font-size:12px;color:var(--text-bright);font-weight:500;line-height:1.4">' + item.headline + '</span><span style="flex-shrink:0">' + badge(item.bias) + '</span></div><div style="font-size:11px;color:var(--text-dim);line-height:1.5">' + (item.impact || '') + '</div><div style="margin-top:4px;font-family:var(--mono);font-size:9px;color:' + col + '">' + (item.contracts || '') + '</div></div>';
  });
  document.getElementById('news-content').innerHTML = h;
}

function renderGamePlan(d) {
  if (!d) { document.getElementById('gameplan-content').innerHTML = '<div class="empty">No data</div>'; return; }
  document.getElementById('gameplan-content').innerHTML =
    '<div style="display:grid;gap:10px">' +
    '<div style="background:var(--surface2);border-left:4px solid var(--accent);padding:12px 14px"><div style="font-family:var(--mono);font-size:9px;color:var(--accent);letter-spacing:2px;margin-bottom:4px">OVERALL BIAS</div><div style="color:var(--text-bright);font-size:13px">' + (d.overallBias || 'â€”') + '</div></div>' +
    '<div style="background:var(--surface2);border-left:4px solid var(--accent2);padding:12px 14px"><div style="font-family:var(--mono);font-size:9px;color:var(--accent2);letter-spacing:2px;margin-bottom:4px">PRIMARY TRADE</div><div style="color:var(--text-bright);font-size:13px">' + (d.primaryTrade || 'â€”') + '</div></div>' +
    '<div style="background:var(--surface2);border-left:4px solid var(--yellow);padding:12px 14px"><div style="font-family:var(--mono);font-size:9px;color:var(--yellow);letter-spacing:2px;margin-bottom:4px">SECONDARY TRADE</div><div style="color:var(--text-bright);font-size:13px">' + (d.secondaryTrade || 'â€”') + '</div></div>' +
    '<div style="background:var(--surface2);border-left:4px solid var(--red);padding:12px 14px"><div style="font-family:var(--mono);font-size:9px;color:var(--red);letter-spacing:2px;margin-bottom:4px">KEY RISK</div><div style="color:var(--text-bright);font-size:13px">' + (d.keyRisk || 'â€”') + '</div></div>' +
    '<div style="background:var(--surface2);border-left:4px solid var(--text-dim);padding:12px 14px"><div style="font-family:var(--mono);font-size:9px;color:var(--text-dim);letter-spacing:2px;margin-bottom:4px">AVOID</div><div style="font-size:12px;color:var(--text)">' + (d.avoid || 'â€”') + '</div></div>' +
    '<div style="background:var(--surface2);border-left:4px solid var(--text-dim);padding:12px 14px"><div style="font-family:var(--mono);font-size:9px;color:var(--text-dim);letter-spacing:2px;margin-bottom:4px">SESSION FOCUS</div><div style="font-size:12px;color:var(--text)">' + (d.sessionFocus || 'â€”') + '</div></div>' +
    '<div style="background:rgba(255,61,90,0.07);border:1px solid rgba(255,61,90,0.2);padding:12px 14px"><div style="font-family:var(--mono);font-size:9px;color:var(--red);letter-spacing:2px;margin-bottom:4px">RISK MANAGEMENT</div><div style="font-size:12px;color:var(--text)">' + (d.maxLoss || '') + '</div><div style="font-size:12px;color:var(--text);margin-top:6px">' + (d.mentalCheck || '') + '</div></div>' +
    '</div>';
}

function renderOptionsFlow(d) {
  if (!d) { document.getElementById('options-flow-content').innerHTML = '<div class="empty">No data</div>'; return; }
  const mode = (d.dealerMode || '').toUpperCase();
  const isLong = mode.includes('LONG') || mode.includes('POS');
  const modeColor = isLong ? 'var(--accent2)' : 'var(--red)';
  const modeIcon = isLong ? 'ğŸŸ¢' : 'ğŸ”´';
  const modeClass = isLong ? 'bull' : 'bear';

  let gexHtml = '';
  (d.gexByContract || []).forEach(g => {
    const isPos = !String(g.gex || '').startsWith('-');
    const pct = Math.min(Math.abs(parseFloat(g.gexPct) || 50), 100);
    const col = isPos ? 'var(--accent2)' : 'var(--red)';
    gexHtml += '<div class="gex-bar-wrap"><div class="gex-label">' + g.contract + '</div><div class="gex-bar-track"><div class="gex-bar-fill ' + (isPos ? 'pos' : 'neg') + '" style="width:' + pct + '%"></div></div><div class="gex-val" style="color:' + col + '">' + g.gex + ' <span style="font-size:8px;color:var(--text-dim)">' + (g.regime || '') + '</span></div></div>';
  });

  let strikesHtml = '';
  (d.keyStrikes || []).forEach(s => {
    const tc = s.type === 'CALL WALL' ? 'call-wall' : s.type === 'PUT WALL' ? 'put-wall' : s.type === 'GAMMA FLIP' ? 'gamma-flip' : s.type === 'MAX PAIN' ? 'max-pain' : 'pin-zone';
    const pc = s.type === 'CALL WALL' ? 'var(--red)' : s.type === 'PUT WALL' ? 'var(--accent2)' : s.type === 'GAMMA FLIP' ? 'var(--yellow)' : 'var(--accent)';
    strikesHtml += '<div class="strike-level"><div class="strike-price" style="color:' + pc + '">' + s.strike + '</div><span class="strike-type ' + tc + '">' + s.type + '</span><div style="flex:1;font-size:11px;color:var(--text-dim)">' + s.meaning + '</div></div>';
  });

  const vc = d.vannaCharm || {};
  const fs = d.flowSignals || {};
  document.getElementById('options-flow-content').innerHTML =
    '<div class="options-grid"><div>' +
    '<div class="options-sub-label">Dealer Positioning</div>' +
    '<div class="dealer-mode ' + modeClass + '"><div class="dealer-mode-title" style="color:' + modeColor + '">' + modeIcon + ' ' + (d.dealerMode || '') + '</div><div class="dealer-mode-body">' + (d.dealerModeExplain || '') + '</div></div>' +
    '<div class="options-sub-label" style="margin-top:14px">GEX by Market</div>' + gexHtml +
    '<div class="options-sub-label" style="margin-top:14px">Vanna & Charm</div>' +
    '<div class="dealer-mode neutral" style="margin-bottom:0"><div class="dealer-mode-title" style="color:var(--yellow)">ğŸŒŠ VANNA</div><div class="dealer-mode-body">' + (vc.vanna || 'â€”') + '</div></div>' +
    '<div class="dealer-mode neutral" style="margin-top:8px;margin-bottom:0"><div class="dealer-mode-title" style="color:var(--accent)">â³ CHARM</div><div class="dealer-mode-body">' + (vc.charm || 'â€”') + '</div></div>' +
    '</div><div>' +
    '<div class="options-sub-label">Key Strike Levels</div>' +
    '<div style="background:var(--surface2);border:1px solid var(--border)">' + (strikesHtml || '<div style="padding:14px;color:var(--text-dim);font-size:11px">No strike data</div>') + '</div>' +
    '<div class="options-sub-label" style="margin-top:14px">Flow Signals</div>' +
    '<div class="flow-signal-grid">' +
    '<div class="flow-signal-item" style="border-left:3px solid var(--red)"><div class="flow-signal-label">Call Wall</div><div class="flow-signal-val">' + (fs.callWallAction || 'â€”') + '</div></div>' +
    '<div class="flow-signal-item" style="border-left:3px solid var(--accent2)"><div class="flow-signal-label">Put Wall</div><div class="flow-signal-val">' + (fs.putWallAction || 'â€”') + '</div></div>' +
    '<div class="flow-signal-item" style="border-left:3px solid var(--yellow)"><div class="flow-signal-label">Gamma Flip</div><div class="flow-signal-val">' + (fs.gammaFlipAction || 'â€”') + '</div></div>' +
    '<div class="flow-signal-item" style="border-left:3px solid var(--accent)"><div class="flow-signal-label">0DTE</div><div class="flow-signal-val">' + (fs.zdteAction || 'â€”') + '</div></div>' +
    '</div>' +
    '<div class="options-sub-label" style="margin-top:14px">IV Snapshot</div>' +
    '<div>' + (d.ivSnapshot || []).map(iv => '<div class="vol-chip"><span>' + iv.contract + '</span>IV: ' + iv.iv + ' &nbsp;|&nbsp; Skew: ' + iv.skew + '</div>').join('') + '</div>' +
    '<div style="margin-top:14px;background:var(--surface2);border:1px solid var(--border);border-left:4px solid var(--accent);padding:12px 14px"><div style="font-family:var(--mono);font-size:9px;letter-spacing:2px;color:var(--accent);margin-bottom:6px">TRADER TAKEAWAY</div><div style="font-size:12px;color:var(--text-bright);line-height:1.7">' + (d.traderTakeaway || 'â€”') + '</div></div>' +
    '</div></div>';
}

function renderAIOverview(text) {
  document.getElementById('ai-overview-content').innerHTML = '<div class="ai-block">' + text + '</div>';
}

// â”€â”€ GENERATE FULL BRIEF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function generateFullBrief() {
  const apiKey = getApiKey();
  if (!apiKey || !apiKey.startsWith('sk-ant')) {
    setStatus('âœ— Enter your Anthropic API key above first', 'error');
    document.getElementById('api-key-input').focus();
    return;
  }

  const today = getDate();
  const esN = parseFloat(document.getElementById('es-price').value) || 6880;
  const nqN = parseFloat(document.getElementById('nq-price').value) || 24900;
  const clN = parseFloat(document.getElementById('cl-price').value) || 67;
  const gcN = parseFloat(document.getElementById('gc-price').value) || 5200;

  try {
    // CALL 1: Macro
    setStatus('âš¡ 1/4 â€” Macro snapshot...', 'loading');
    const r1 = await claudeCall(
      'Today is ' + today + '. ES=' + esN + ' NQ=' + nqN + ' CL=' + clN + ' GC=' + gcN + '. Return a JSON object with a "macro" array of 8 items, each with: name, price, change, changePct, signal (BULLISH/BEARISH/NEUTRAL/ELEVATED). Use the prices given as anchors. Items: S&P 500 Futures (ES), Nasdaq Futures (NQ), US Dollar Index (DXY), 10Y Treasury Yield, VIX Volatility, Crude Oil (CL), Gold Futures (GC), Copper (HG).',
      1000, true
    );
    try { renderMacro(parseJ(r1).macro); } catch(e) {
      renderMacro([
        {name:'S&P 500 Futures (ES)', price:String(esN), change:'', changePct:'', signal:'NEUTRAL'},
        {name:'Nasdaq Futures (NQ)',  price:String(nqN), change:'', changePct:'', signal:'NEUTRAL'},
        {name:'Crude Oil (CL)',       price:String(clN), change:'', changePct:'', signal:'NEUTRAL'},
        {name:'Gold Futures (GC)',    price:String(gcN), change:'', changePct:'', signal:'BULLISH'}
      ]);
    }

    // CALL 2: Watchlist + Calendar
    setStatus('âš¡ 2/4 â€” Watchlist & calendar...', 'loading');
    const r2 = await claudeCall(
      'Today is ' + today + '. ES=' + esN + ' CL=' + clN + ' GC=' + gcN + '. Return a JSON object with: "watchlist" array (8 items, each: contract, bias, support, resistance, setup, idea) and "calendar" array (3-5 items, each: time, event, forecast, impact). Support/resistance must be near the given prices. Calendar must show real events scheduled for today.',
      1400, true
    );
    try { const d2 = parseJ(r2); renderWatchlist(d2.watchlist); renderCalendar(d2.calendar); } catch(e) { console.warn('watchlist:', e); }

    // CALL 3: COT + News + Game Plan
    setStatus('âš¡ 3/4 â€” COT & news...', 'loading');
    const r3 = await claudeCall(
      'Today is ' + today + '. Return a JSON object with: "cot" array (7 contracts: Gold GC, Crude Oil CL, Natural Gas NG, Silver SI, Copper HG, Corn ZC, Soybeans ZS â€” each with: contract, netSpec, wowChange, signal, interpretation), "news" array (5 items each: headline, bias, impact, contracts), and "gamePlan" object (overallBias, primaryTrade, secondaryTrade, avoid, keyRisk, sessionFocus, maxLoss, mentalCheck).',
      1400, true
    );
    try { const d3 = parseJ(r3); renderCOT(d3.cot); renderNews(d3.news); renderGamePlan(d3.gamePlan); } catch(e) { console.warn('cot:', e); }

    // CALL 4: Options
    setStatus('âš¡ 4/4 â€” Options flow...', 'loading');
    const cw = Math.round((esN + 75) / 25) * 25;
    const gf = Math.round((esN - 25) / 25) * 25;
    const pw = Math.round((esN - 125) / 25) * 25;
    const mp = Math.round((esN - 50) / 25) * 25;
    const r4 = await claudeCall(
      'Today is ' + today + '. ES at ' + esN + '. Return a JSON object with: dealerMode (string), dealerModeExplain (string), gexByContract (array of 4: ES NQ GC CL, each: contract gex gexPct regime), keyStrikes (array of 5: use strikes near ' + cw + ' ' + gf + ' ' + pw + ' ' + mp + ', each: strike type meaning â€” types: CALL WALL GAMMA FLIP PUT WALL MAX PAIN PIN ZONE), vannaCharm (object: vanna charm), flowSignals (object: callWallAction putWallAction gammaFlipAction zdteAction), ivSnapshot (array of 4: ES NQ GC CL, each: contract iv skew), traderTakeaway (string).',
      1400, true
    );
    try { renderOptionsFlow(parseJ(r4)); } catch(e) { console.warn('options:', e); }

    // AI Overview
    setStatus('âš¡ Generating AI overview...', 'loading');
    try {
      const r5 = await claudeCall(
        'Today is ' + today + '. ES=' + esN + ' NQ=' + nqN + ' CL=' + clN + ' GC=' + gcN + '. Write 3 short paragraphs for a futures day trader: (1) macro backdrop and what it means for commodities today, (2) biggest opportunity and risk in CL/GC/NG/HG with specific price levels, (3) one actionable trade setup with entry stop and target. Be direct and specific.',
        800, false
      );
      renderAIOverview(r5);
    } catch(e) { renderAIOverview('AI overview unavailable â€” all other sections loaded.'); }

    document.getElementById('last-updated').textContent = 'Updated: ' + today + ' ' + getTime();
    setStatus('âœ“ Brief complete â€” ' + today, 'done');
    try { localStorage.setItem('marketmacros-lastgen', new Date().toDateString()); } catch(e) {}

  } catch(err) {
    console.error(err);
    setStatus('âœ— ' + err.message, 'error');
  }
}

// â”€â”€ TEST API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function testApiConnection() {
  const apiKey = getApiKey();
  if (!apiKey || !apiKey.startsWith('sk-ant')) {
    setStatus('âœ— No valid API key', 'error');
    return;
  }
  setStatus('ğŸ”§ Testing API...', 'loading');
  try {
    const text = await claudeCall('Reply with only the word: working', 'Test connection now', 20, false);
    setStatus('âœ… API connected! Ready to generate.', 'done');
  } catch(e) {
    setStatus('âœ— Test failed: ' + e.message, 'error');
  }
}

// â”€â”€ EVENT ANALYZER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function analyzeEvent() {
  const input = document.getElementById('event-input').value.trim();
  if (!input) { setStatus('âš  Enter a market event to analyze', 'error'); return; }
  const apiKey = getApiKey();
  if (!apiKey || !apiKey.startsWith('sk-ant')) { setStatus('âœ— API key required', 'error'); return; }
  const esN = parseFloat(document.getElementById('es-price').value) || 6880;
  const clN = parseFloat(document.getElementById('cl-price').value) || 67;
  const gcN = parseFloat(document.getElementById('gc-price').value) || 5200;
  setStatus('ğŸ”” Analyzing event...', 'loading');
  try {
    const r = await claudeCall(
      'Today is ' + getDate() + '. ES=' + esN + ' CL=' + clN + ' GC=' + gcN + '. Analyze this market event: "' + input + '". Return a JSON object with: title, surprise, overallImpact (BULLISH/BEARISH/MIXED), immediateReaction, contractImpacts (array of 3-5: contract direction magnitude reasoning), macroImplication, traderAction, watchLevel, riskToThesis.',
      1000, true
    );
    const d = parseJ(r);
    const impCol = (d.overallImpact||'').toLowerCase().includes('bull') ? 'var(--accent2)' : (d.overallImpact||'').toLowerCase().includes('bear') ? 'var(--red)' : 'var(--yellow)';
    let ciHtml = '';
    (d.contractImpacts||[]).forEach(c => {
      const col = (c.direction||'').toLowerCase().includes('bull') ? 'var(--accent2)' : (c.direction||'').toLowerCase().includes('bear') ? 'var(--red)' : 'var(--text-dim)';
      ciHtml += '<div style="display:flex;gap:8px;padding:8px 0;border-bottom:1px solid var(--border);align-items:flex-start"><span style="font-family:var(--mono);font-size:10px;color:var(--accent);min-width:32px">' + c.contract + '</span><span style="color:' + col + ';font-size:11px;min-width:60px">' + (c.direction||'') + '</span><span style="font-size:11px;color:var(--text-dim)">' + (c.reasoning||'') + '</span></div>';
    });
    const html = '<div style="background:var(--surface2);border-left:4px solid ' + impCol + ';padding:14px;margin-bottom:14px"><div style="font-family:var(--mono);font-size:9px;letter-spacing:2px;color:var(--text-dim);margin-bottom:4px">EVENT ANALYSIS</div><div style="font-size:14px;font-weight:700;color:var(--text-bright);margin-bottom:8px">' + (d.title||input) + '</div><div style="display:flex;gap:10px;margin-bottom:8px">' + badge(d.overallImpact) + '<span style="font-size:12px;color:var(--text-dim)">' + (d.surprise||'') + '</span></div><div style="font-size:12px;color:var(--text);line-height:1.6">' + (d.immediateReaction||'') + '</div></div>' +
      '<div style="margin-bottom:14px"><div style="font-family:var(--mono);font-size:9px;letter-spacing:2px;color:var(--accent);margin-bottom:8px">CONTRACT IMPACTS</div>' + ciHtml + '</div>' +
      '<div style="background:var(--surface2);padding:12px;margin-bottom:10px"><div style="font-family:var(--mono);font-size:9px;color:var(--yellow);margin-bottom:4px">MACRO IMPLICATION</div><div style="font-size:12px;color:var(--text)">' + (d.macroImplication||'') + '</div></div>' +
      '<div style="background:var(--surface2);border-left:4px solid var(--accent2);padding:12px;margin-bottom:10px"><div style="font-family:var(--mono);font-size:9px;color:var(--accent2);margin-bottom:4px">TRADER ACTION</div><div style="font-size:12px;color:var(--text-bright)">' + (d.traderAction||'') + '</div></div>' +
      '<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px"><div style="background:var(--surface2);padding:10px"><div style="font-family:var(--mono);font-size:9px;color:var(--accent);margin-bottom:4px">WATCH LEVEL</div><div style="font-size:12px;color:var(--text)">' + (d.watchLevel||'') + '</div></div><div style="background:var(--surface2);padding:10px"><div style="font-family:var(--mono);font-size:9px;color:var(--red);margin-bottom:4px">RISK TO THESIS</div><div style="font-size:12px;color:var(--text)">' + (d.riskToThesis||'') + '</div></div></div>';
    document.getElementById('event-result').innerHTML = html;
    setStatus('âœ“ Event analyzed', 'done');
  } catch(e) {
    setStatus('âœ— ' + e.message, 'error');
  }
}

// â”€â”€ PWA / INSTALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function registerSW() {
  if (!('serviceWorker' in navigator)) return;
  const swCode = 'self.addEventListener("fetch",e=>{});';
  const blob = new Blob([swCode], {type:'application/javascript'});
  navigator.serviceWorker.register(URL.createObjectURL(blob)).catch(() => {});
}
registerSW();

let deferredPrompt = null;
window.addEventListener('beforeinstallprompt', e => {
  e.preventDefault();
  deferredPrompt = e;
  setTimeout(() => {
    try { if (!localStorage.getItem('mm-install-dismissed')) document.getElementById('install-banner').classList.add('show'); } catch(e) {}
  }, 3000);
});
function installPWA() {
  if (deferredPrompt) { deferredPrompt.prompt(); deferredPrompt.userChoice.then(() => { deferredPrompt = null; document.getElementById('install-banner').classList.remove('show'); }); }
}
function dismissInstall() {
  document.getElementById('install-banner').classList.remove('show');
  try { localStorage.setItem('mm-install-dismissed', '1'); } catch(e) {}
}

// iOS install hint
(function() {
  const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
  if (isIOS && !window.navigator.standalone) {
    try { if (localStorage.getItem('mm-ios-hint')) return; } catch(e) {}
    setTimeout(() => {
      const d = document.createElement('div');
      d.style.cssText = 'position:fixed;bottom:0;left:0;right:0;z-index:3000;background:var(--surface);border-top:2px solid var(--accent);padding:16px 20px;padding-bottom:max(16px,env(safe-area-inset-bottom));font-family:var(--sans);text-align:center';
      d.innerHTML = '<div style="font-size:13px;font-weight:600;color:var(--text-bright);margin-bottom:6px">ğŸ“± Add MarketMacros to Home Screen</div><div style="font-size:12px;color:var(--text-dim);margin-bottom:10px">Tap <strong style="color:var(--accent)">Share â†‘</strong> then <strong style="color:var(--accent)">Add to Home Screen</strong></div><button onclick="this.parentElement.remove();try{localStorage.setItem(\'mm-ios-hint\',\'1\')}catch(e){}" style="background:var(--accent);color:var(--bg);border:none;padding:8px 24px;font-family:var(--mono);font-size:11px;letter-spacing:1px;cursor:pointer;font-weight:700">GOT IT</button>';
      document.body.appendChild(d);
    }, 4000);
  }
})();

// Mobile nav
function mobileNav(id, btn) {
  document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  const el = document.getElementById(id);
  if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// Wake lock
(async function() {
  try { if ('wakeLock' in navigator) await navigator.wakeLock.request('screen'); } catch(e) {}
})();

// Enter key on event input
document.getElementById('event-input').addEventListener('keydown', e => { if (e.key === 'Enter') analyzeEvent(); });

</script></script>

</body>
</html>
